{"version":3,"sources":["../../src/features/users/use-cases/activateUserAccount.ts"],"names":[],"mappings":";;;;;;AAAA,sEAAmE;AAGnE,2DAAqC;AACrC,2EAAmD;AAGnD,SAAiB,uBAAuB,CAAC,EAAC,UAAU,EAA8B;IACjF,OAAO,KAAK,EAAE,KAAa,EAAE,EAAE;QAC9B,MAAM,EAAE,MAAM,EAAE,KAAK,EAAC,GAAE,MAAM,kBAAQ,CAAC,iBAAiB,CAAC,KAAK,CAA8B,CAAC;QAC7F,IAAI,CAAC,KAAK,EAAE;YACX,MAAM,IAAI,2BAAY,CAAC;gBACtB,OAAO,EAAE,mBAAmB;gBAC5B,MAAM,EAAE,SAAS;gBACjB,UAAU,EAAE,GAAG;gBACf,IAAI,EAAE;oBACL,KAAK;iBACL;aACD,CAAC,CAAC;SACH;QACD,MAAM,QAAQ,GAAG,MAAM,UAAU,CAAC,WAAW,CAAC,KAAK,CAAC,CAAC;QACrD,IAAI,CAAC,QAAQ,EAAE;YACd,MAAM,IAAI,2BAAY,CAAC;gBACtB,OAAO,EAAE,gBAAgB;gBACzB,MAAM,EAAE,SAAS;gBACjB,UAAU,EAAE,GAAG;gBACf,IAAI,EAAE;oBACL,KAAK;iBACL;aACD,CAAC,CAAC;SACH;QACD,IAAI,QAAQ,CAAC,QAAQ,EAAE;YACtB,MAAM,IAAI,2BAAY,CAAC;gBACtB,OAAO,EAAE,gCAAgC;gBACzC,MAAM,EAAE,SAAS;gBACjB,UAAU,EAAE,GAAG;gBACf,IAAI,EAAE,EACL;aACD,CAAC,CAAC;SACH;QACD,IAAI,QAAQ,CAAC,SAAS,EAAE;YACvB,MAAM,IAAI,2BAAY,CAAC;gBACtB,OAAO,EAAE,+BAA+B;gBACxC,MAAM,EAAE,SAAS;gBACjB,UAAU,EAAE,GAAG;gBACf,IAAI,EAAE,EACL;aACD,CAAC,CAAC;SACH;QACD,IAAI,CAAC,KAAK,EAAE;YACX,MAAM,IAAI,2BAAY,CAAC;gBACtB,OAAO,EAAE,mBAAmB;gBAC5B,MAAM,EAAE,SAAS;gBACjB,UAAU,EAAE,GAAG;gBACf,IAAI,EAAE;oBACL,KAAK;iBACL;aACD,CAAC,CAAC;SACH;QACD,IAAI,CAAC,MAAM,EAAE;YACZ,MAAM,IAAI,2BAAY,CAAC;gBACtB,OAAO,EAAE,kBAAkB;gBAC3B,MAAM,EAAE,SAAS;gBACjB,UAAU,EAAE,GAAG;gBACf,IAAI,EAAE;oBACL,KAAK;iBACL;aACD,CAAC,CAAC;SACH;QACD,IAAI,MAAM,KAAK,QAAQ,CAAC,EAAE,EAAE;YAC3B,MAAM,IAAI,2BAAY,CAAC;gBACtB,OAAO,EAAE,kBAAkB;gBAC3B,MAAM,EAAE,SAAS;gBACjB,UAAU,EAAE,GAAG;gBACf,IAAI,EAAE;oBACL,KAAK;iBACL;aACD,CAAC,CAAC;SACH;QACD,MAAM,EAAE,MAAM,EAAE,QAAQ,EAAE,YAAY,EAAE,SAAS,EAAE,WAAW,EAAE,WAAW,EAAE,aAAa,EAAE,GAAG,MAAM,IAAA,kBAAU,kCAAM,QAAQ,CAAC,IAAI,KAAE,QAAQ,EAAE,IAAI,IAAG,CAAC;QACtJ,MAAM,IAAI,GAAG,MAAM,UAAU,CAAC,UAAU,CAAC,QAAQ,CAAC,GAAG,EAAE;YACtD,KAAK,EAAE,QAAQ,EAAE;YACjB,QAAQ,EAAE,IAAI;YACd,SAAS,EAAE,YAAY,EAAE;YACzB,QAAQ,EAAE,WAAW,EAAE;YACvB,MAAM,EAAE,SAAS,EAAE;YACnB,QAAQ,EAAE,WAAW,EAAE;YACvB,GAAG,EAAE,MAAM,EAAE;YACb,cAAc,EAAE,aAAa,EAAE;SAC/B,CAAC,CAAC;QAEH,OAAO,IAAI,CAAC;IACb,CAAC,CAAC;AACH,CAAC;AAtFD,0DAsFC","file":"activateUserAccount.js","sourcesContent":["import { ExpressError } from '../../../common/errors/ExpressError';\nimport { IUserRepository } from '../interfaces';\nimport { JWTPayloadType } from '../../../common/types';\nimport createUser from '../entities';\nimport tokenGEN from '../../../utils/jwt/tokenGEN';\n\n\nexport  function makeActivateUserAccount({repository}:{repository:IUserRepository}){\n\treturn async (token: string) => {\n\t\tconst { userId ,email} =await tokenGEN.decodeSimpleToken(token) as unknown as JWTPayloadType;\n\t\tif (!email) {\n\t\t\tthrow new ExpressError({\n\t\t\t\tmessage: 'Email is required',\n\t\t\t\tstatus: 'warning',\n\t\t\t\tstatusCode: 400,\n\t\t\t\tdata: {\n\t\t\t\t\temail\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\tconst existing = await repository.findByEmail(email);\n\t\tif (!existing) {\n\t\t\tthrow new ExpressError({\n\t\t\t\tmessage: 'User not found',\n\t\t\t\tstatus: 'warning',\n\t\t\t\tstatusCode: 404,\n\t\t\t\tdata: {\n\t\t\t\t\temail\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\tif (existing.isActive) {\n\t\t\tthrow new ExpressError({\n\t\t\t\tmessage: 'User account already activated',\n\t\t\t\tstatus: 'warning',\n\t\t\t\tstatusCode: 409,\n\t\t\t\tdata: {\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\tif (existing.isDeleted) {\n\t\t\tthrow new ExpressError({\n\t\t\t\tmessage: 'User account has been deleted',\n\t\t\t\tstatus: 'warning',\n\t\t\t\tstatusCode: 409,\n\t\t\t\tdata: {\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\tif (!token) {\n\t\t\tthrow new ExpressError({\n\t\t\t\tmessage: 'Token is required',\n\t\t\t\tstatus: 'warning',\n\t\t\t\tstatusCode: 400,\n\t\t\t\tdata: {\n\t\t\t\t\ttoken\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\tif (!userId) {\n\t\t\tthrow new ExpressError({\n\t\t\t\tmessage: 'Token is invalid',\n\t\t\t\tstatus: 'warning',\n\t\t\t\tstatusCode: 400,\n\t\t\t\tdata: {\n\t\t\t\t\ttoken\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\tif (userId !== existing.id) {\n\t\t\tthrow new ExpressError({\n\t\t\t\tmessage: 'Token is invalid',\n\t\t\t\tstatus: 'warning',\n\t\t\t\tstatusCode: 400,\n\t\t\t\tdata: {\n\t\t\t\t\ttoken\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\tconst { getBio, getEmail, getFirstName, getGender, getLastName, getPassword, getProfilePic } = await createUser({ ...existing._doc, isActive: true });\n\t\tconst user = await repository.updateById(existing._id, {\n\t\t\temail: getEmail(),\n\t\t\tisActive: true,\n\t\t\tfirstName: getFirstName(),\n\t\t\tlastName: getLastName(),\n\t\t\tgender: getGender(),\n\t\t\tpassword: getPassword(),\n\t\t\tbio: getBio(),\n\t\t\tprofilePicture: getProfilePic()\n\t\t});\n\n\t\treturn user;\n\t};\n}"]}